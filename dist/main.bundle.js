module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PASSWORD_CHECKPASSWORD_DIFFERENT_ERR_RESULT=t.UPDATE_ERR_ERSULT=t.TOKEN_ERR_RESULT=t.LOGIN_ERR_RESULT=t.EMAIL_FOEMAT_ERR_RESULT=t.EMAIL_MUTIPLE_ERR_RESULT=t.SERVER_ERR_RESULT=void 0;t.SERVER_ERR_RESULT={status:"註冊失敗",err:"伺服器錯誤，請稍後在試！"};t.EMAIL_MUTIPLE_ERR_RESULT={status:"註冊失敗",err:"已有重複Email"};t.EMAIL_FOEMAT_ERR_RESULT={status:"註冊失敗。",err:"請輸入正確的Eamil格式。(如1234@email.com)"};t.LOGIN_ERR_RESULT={status:"登入失敗。",err:"請輸入正確的帳號或密碼。"};t.TOKEN_ERR_RESULT={status:"token錯誤。",err:"請重新登入。"};t.UPDATE_ERR_ERSULT={status:"會員資料更新失敗。",err:"伺服器錯誤，請稍後在試！"};t.PASSWORD_CHECKPASSWORD_DIFFERENT_ERR_RESULT={status:"密碼與確認密碼不同",err:"請再重新輸入一次"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(13).config();var n={mysql:{host:process.env.HOST,user:process.env.DATABASE_USER,password:process.env.DATABASE_PASSWORD,database:process.env.DATABASE},secret:process.env.SECRET};t.default=n},function(e,t,r){"use strict";var n,o=(n=r(1))&&n.__esModule?n:{default:n};var s=r(15).createConnection({host:o.default.mysql.host,user:o.default.mysql.user,password:o.default.mysql.password,database:o.default.mysql.database});s.connect((function(e){e?(console.log(e),console.log("connecting error")):console.log("connecting success")})),e.exports=s},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){var n=r(6),o=r(20)("member:server"),s=r(21),u=process.env.PORT||"3100";n.set("port",u);var a=s.createServer(n);a.listen(u),a.on("error",(function(e){if("listen"!==e.syscall)throw e;var t="string"==typeof u?"Pipe "+u:"Port "+u;switch(e.code){case"EACCES":console.error(t+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(t+" is already in use"),process.exit(1);break;default:throw e}})),a.on("listening",(function(){console.log("server start on",u);var e=a.address(),t="string"==typeof e?"pipe "+e:"port "+e.port;o("Listening on "+t)}))},function(e,t,r){"use strict";(function(t){var n=r(7),o=r(3),s=r(8),u=r(9),a=r(10),i=r(11),l=o();l.set("views",s.join(t,"src/views")),l.set("view engine","ejs"),l.use(a("dev")),l.use(o.json()),l.use(o.urlencoded({extended:!1})),l.use(u()),l.use(o.static(s.join(t,"src/public"))),l.get("/",(function(e,t){t.send("index")})),l.use("/",i),l.use((function(e,t,r){r(n(404))})),l.use((function(e,t,r,n){r.locals.message=e.message,r.locals.error="development"===t.app.get("env")?e:{},r.status(e.status||500),r.render("error")})),e.exports=l}).call(this,"/")},function(e,t){e.exports=require("http-errors")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("morgan")},function(e,t,r){"use strict";var n,o=(n=r(12))&&n.__esModule?n:{default:n};var s=r(3).Router();console.log("MemberModifyController",(new o.default).postRegister);var u=new o.default;s.post("/register",u.postRegister),s.post("/login",u.postLogin),s.post("/update",u.postUpdate),e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=c(r(1)),o=c(r(14)),s=c(r(16)),u=c(r(17)),a=c(r(4)),i=r(0),l=r(18);function c(e){return e&&e.__esModule?e:{default:e}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registerModelClass=new o.default,this.loginModelClass=new s.default,this.updateModelClass=new u.default}var t,r,c;return t=e,(r=[{key:"postRegister",value:function(e,t,r){var n={name:e.body.name,email:e.body.email,password:(0,l.setPasswordCryproSHA1)(e.body.password),create_date:(0,l.onTime)()};(0,l.checkEmail)(e.body.email)?this.registerModelClass.registerModel(n).then((function(e){t.json({status:"註冊成功。",result:e})}),(function(e){t.json({result:e})})):t.json({result:i.EMAIL_FOEMAT_ERR_RESULT})}},{key:"postLogin",value:function(e,t,r){var o={email:e.body.email,password:(0,l.setPasswordCryproSHA1)(e.body.password)};this.loginModelClass.memberLogin(o).then((function(e){if(!0===(0,l.checkNull)(e))t.json({result:i.LOGIN_ERR_RESULT});else if(!1===(0,l.checkNull)(e)){var r=a.default.sign({algorithm:"HSA256",exp:Math.floor(Date.now()/1e3)+3600,data:e[0].id},n.default.secret);t.setHeader("token",r),t.json({result:{status:"登入成功。",loginMember:"歡迎 "+e[0].name+" 的登入！"}})}}))}},{key:"postUpdate",value:function(e,t,r){var n=this,o=e.headers.token,s=e.body.password,u=e.body.checkPassword;!0!==(0,l.checkNull)(o)?(0,l.checkVerifyToken)(o).then((function(e){if(e){var r=e;if(s===u){var o=(0,l.setPasswordCryproSHA1)(s);n.updateModelClass.updatePassword(r,o).then((function(e){t.json({result:e})}),(function(e){t.json({result:e})}))}else t.json({result:i.PASSWORD_CHECKPASSWORD_DIFFERENT_ERR_RESULT})}else t.json({result:i.TOKEN_ERR_RESULT})})):t.json({result:i.TOKEN_ERR_RESULT})}}])&&f(t.prototype,r),c&&f(t,c),e}();t.default=d},function(e,t){e.exports=require("dotenv")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(2))&&n.__esModule?n:{default:n},s=r(0);function u(e,t,r,n,o,s,u){try{var a=e[s](u),i=a.value}catch(e){return void r(e)}a.done?t(i):Promise.resolve(i).then(n,o)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"checkMutipleEmail",value:function(e){return new Promise((function(t,r){var n={};o.default.query("SELECT email from member_info WHERE email = ?",e,(function(e,r){e&&(n={flag:!1,errMsg:s.SERVER_ERR_RESULT},t(n)),r.length>=1&&(n={flag:!1,errMsg:s.EMAIL_MUTIPLE_ERR_RESULT},t(n)),t(n={flag:!0})}))}))}},{key:"registerModel",value:function(e){var t=this,r={};return new Promise(function(){var n,s=(n=regeneratorRuntime.mark((function n(s,u){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.checkMutipleEmail(e.email);case 2:(a=n.sent).flag?o.default.query("INSERT INTO member_info SET ? ",e,(function(t,n){if(t)return r.status="註冊失敗。",r.err="伺服器錯誤，請稍後在試！",void u(r);r.registerMember=e,s(r)})):(r=a.errMsg,s(r));case 4:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,o){var s=n.apply(e,t);function a(e){u(s,r,o,a,i,"next",e)}function i(e){u(s,r,o,a,i,"throw",e)}a(void 0)}))});return function(e,t){return s.apply(this,arguments)}}())}}])&&a(t.prototype,r),n&&a(t,n),e}();t.default=i},function(e,t){e.exports=require("mysql")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(2))&&n.__esModule?n:{default:n},s=r(0);function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"memberLogin",value:function(e){var t={};return new Promise((function(r,n){o.default.query("SELECT * FROM member_info WHERE email = ? AND password = ?",[e.email,e.password],(function(e,o){if(e)return t=s.SERVER_ERR_RESULT,void n(t);r(o)}))}))}}])&&u(t.prototype,r),n&&u(t,n),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(2))&&n.__esModule?n:{default:n},s=r(0);function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"updatePassword",value:function(e,t){var r={};return new Promise((function(n,u){o.default.query("UPDATE member_info SET password = ? WHERE id = ?",[t,e],(function(e,t){return e?(console.log(e),r=s.UPDATE_ERR_ERSULT,void u(r)):(r.status="會員資料更新成功。",void n(r))}))}))}}])&&u(t.prototype,r),n&&u(t,n),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkNull=t.checkVerifyToken=t.setPasswordCryproSHA1=t.checkEmail=t.onTime=void 0;var n=u(r(19)),o=u(r(4)),s=u(r(1));function u(e){return e&&e.__esModule?e:{default:e}}t.onTime=function(){var e=new Date,t=e.getMonth()+1,r=e.getDate(),n=e.getHours(),o=e.getMinutes(),s=e.getSeconds();return[e.getFullYear(),"-"+(t>9?"":"0")+t,"-"+(r>9?"":"0")+r," "+(n>9?"":"0")+n,":"+(o>9?"":"0")+o,":"+(s>9?"":"0")+s].join("")};t.checkEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)};t.setPasswordCryproSHA1=function(e){var t=n.default.createHash("sha1");return t.update(e),t.digest("hex")};t.checkVerifyToken=function(e){var t="",r=Math.floor(Date.now()/1e3);return new Promise((function(n,u){e&&o.default.verify(e,s.default.secret,(function(e,o){t=!e&&(!(o.exp<=r)&&o.data),n(t)}))}))};t.checkNull=function(e){for(var t in e)return!1;return!0}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("http")}]);